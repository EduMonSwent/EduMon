package com.android.sample.ui.flashcards.model

import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.android.sample.ui.flashcards.data.FirestoreFlashcardsRepoProvider
import com.android.sample.ui.flashcards.data.FlashcardsRepository
import kotlinx.coroutines.flow.MutableStateFlow
import kotlinx.coroutines.flow.StateFlow
import kotlinx.coroutines.launch

/**
 * ViewModel responsible for handling the "Import Shared Deck" workflow.
 *
 * Some parts of this code have been generated by an LLM (ChatGPT).
 */
class ImportDeckViewModel(
    private val repo: FlashcardsRepository = FirestoreFlashcardsRepoProvider.get()
) : ViewModel() {

  private val _state = MutableStateFlow(ImportState())
  val state: StateFlow<ImportState> = _state
  /**
   * Attempts to import a shared deck using the provided token. Updates UI state to reflect loading,
   * success, or failure.
   */
  fun importToken(token: String) {
    viewModelScope.launch {
      _state.value = ImportState(loading = true)

      val newId = repo.importSharedDeck(token.trim())

      if (newId.isBlank()) {
        // Token invalid or repository does not support sharing
        _state.value = ImportState(error = "Share code not valid")
      } else {
        _state.value = ImportState(success = true)
      }
    }
  }
}
/** Simple UI state for the ImportDeckScreen. */
data class ImportState(
    val loading: Boolean = false,
    val success: Boolean = false,
    val error: String? = null
)
